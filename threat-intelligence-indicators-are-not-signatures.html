<!doctype html>
<html lang=en> <head><meta name=google-site-verification content=iwCg_a-vVgFpfSWBajnl_3T97hetrL_jHS3nVkinaho><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="InfoSec Zanshin, Thoughts on information security, entrepreneurship and more."><link rel=alternate href=https://asieira.github.io/feeds/all.atom.xml type=application/atom+xml title="InfoSec Zanshin Full Atom Feed"><title>Threat Intelligence Indicators are not Signatures // InfoSec Zanshin // Thoughts on information security, entrepreneurship and more.</title><link rel=apple-touch-icon sizes=57x57 href=/images/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/images/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/images/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/images/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/images/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/images/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/images/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon/favicon-16x16.png><link rel=manifest href=/images/favicon/manifest.json><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-TileImage content=/images/favicon/ms-icon-144x144.png><meta name=theme-color content=#ffffff><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css><link rel=stylesheet href=https://asieira.github.io/theme/css/pure.css><link rel=stylesheet href=https://asieira.github.io/theme/css/pygments.css><script src=//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js></script><script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script></head> <body> <div class=pure-g-r id=layout> <div class="sidebar pure-u"> <div class=cover-img style="background: none repeat scroll 0% 0% #3D4F5D"> <div class=cover-body> <header class=header> <hgroup> <img class=avatar src=/images/zanshin.png> <h1 class=brand-main><a href=https://asieira.github.io>InfoSec Zanshin</a></h1> <p class=tagline>Thoughts on information security, entrepreneurship and more.</p> <p class=social> <a href=feeds/all.atom.xml target=_blank> <i class="fa fa-rss-square fa-2x"></i> </a> <a href=https://br.linkedin.com/in/sieira target=_blank> <i class="fa fa-linkedin-square fa-2x"></i> </a> <a href=https://twitter.com/AlexandreSieira target=_blank> <i class="fa fa-twitter-square fa-2x"></i> </a> <a href=https://github.com/asieira/ target=_blank> <i class="fa fa-github-square fa-2x"></i> </a> </p> </hgroup> </header> </div> </div> </div> <div class=pure-u> <div class=content> <section class=post> <header class=post-header> <h1>Threat Intelligence Indicators are not Signatures</h1> <p class=post-meta> // under <a class=post-category href=https://asieira.github.io/tag/threat-intelligence.html>threat intelligence</a> </p> <p class=post-meta> // Sat 13 February 2016 </p> </header> </section> <p>I have recently participated in a <a href=https://www.blackhat.com/html/webcast/01212016-data-driven-threat-intelligence.html>Black Hat webcast</a> with <a href=https://www.twitter.com/bhaskar_vk>Bhaskar Karambelkar</a>, which was sponsored by <a href=https://threatconnect.com/ >ThreatConnect</a>. This was related to the Black Hat 2015 session called <a href=https://youtu.be/6JMEKnes-w0?list=PLnKLzDQgx6bPRfNuf3sA2Sy2JDjbcg0P5>Data-Driven Threat Intelligence: Metrics On Indicator Dissemination And Sharing</a>, which I had the pleasure to co-present with my good friend <a href=https://twitter.com/alexcpsec>Alex Pinto</a>.</p> <p>At the end of the webcast, someone asked me a question about a comment I had made on how threat intelligence indicators have multiple uses, but should not be used as signatures. One of the audience members was a bit baffled by this, and I am sure he is not alone. </p> <p>So let's focus on automating the use of simple network indicators (IP addresses, domain names and URLs, mostly) that most companies will obtain from public or private threat intelligence feeds. Let me show why <em>using them directly as signatures</em>, such as automatically generating IDS signatures and/or SIEM rules to alert or block on direct matches to them, is very troublesome. Organizations that do that will, in my experience, be most likely flooded with false positives.</p> <p><img alt="False positives, false positives everywhere!" src=https://asieira.github.io/images/indicators-are-not-signatures/false-positives.png></p> <p>Let me go over a (far from complete) list of reasons why.</p> <h2>Affirming the Consequent Fallacy</h2> <p>In order to reliably generate an alert based on network traffic, you need to identify a situation in which the probability of that traffic being malicious is reasonably high. How high it needs to be depends on your organization's tolerance to false positives. So you need to satisfy a requirement <code>P(malicious | traffic) &gt; threshold</code>.</p> <p>Threat intelligence network indicators are data points that say <em>we observed a threat actor, malware or tool A generate traffic with the characteristics M, N and O and to the external locations X, Y and Z</em>. Notice how <strong>that alone does not equal any of the following claims</strong>:</p> <ol> <li> <p>Most or all of the traffic with characteristics M, N or O to destinations X, Y, Z are caused by A;</p> </li> <li> <p>A always causes traffic with characteristics M, N or O to destinations X, Y, Z.</p> </li> </ol> <p>Do you notice the mismatch? Most people will erroneously equate the claim <em>attackers do X</em> to <em>I can safely alert when X occurs in my environment</em>. It's related to the <a href=https://en.wikipedia.org/wiki/Affirming_the_consequent>affirming the consequent fallacy</a>, but it's even more striking because the feeds are not even making claim 2 above, which would be required for the classic form of the fallacy.</p> <p>To give you an example, you could find a perfectly valid indicator saying a piece of malware uses something like a public API from Google, Dropbox or anyone else just to verify whether it can connect to the Internet. Or it could use some publicly available service to identify which public IP address it is reaching the Internet from, and its geolocation, in particular in the case of targeted attacks.</p> <p>This sort of indicator can still be really useful if you are doing DFIR or hunting, as it allows you to narrow down compromised machines on the network, or let you know which forensic data to investigate first. But it should be obvious by now that generating an IDS or SIEM alert for every machine on your network that behaves in a similar manner would be a really bad idea.</p> <h2>What should I match it against?</h2> <p>When you get an intelligence feed, it might contain indicators that are indicative of several different kinds of malicious behaviors. In particular the paid feeds will contain a mix of human-readable context in the form a report, and also the machine-readable indicators associated with each report. </p> <p>The problem is that it can be very hard to automatically determine in which context each technical indicator can be applied. In the case of IP addresses, for example, very rarely does the machine-readable data allow you to unambigously determine something as simple as whether it is associated with <em>inbound</em> traffic, <em>outbound</em> traffic or both.</p> <p>In case you are not familiar with the terminology, the definition of <em>inbound</em> and <em>outbound</em> I'm referring to is the one used in <a href=https://github.com/mlsecproject/combine>combine</a> and <a href=https://github.com/mlsecproject/tiq-test>tiq-test</a>. Keeping your organization as the point of reference, <em>inbound</em> indicators would refer to traffic originating from the open Internet towards your organization's public assets: port scanning, credential brute forcing, automated or manual exploitation of Internet-facing services, etc. <em>Outbound</em> indicators, on the other hand, would be associated with traffic originating from inside your organization's network towards the open Internet, such as data exfiltration, C&amp;C traffic, downloading of malware or client-side exploits.</p> <p>So knowing which traffic <em>direction</em> each indicator applies to would be the most basic way to reduce false positives, and it is often not available for use on an automated fashion.</p> <h2>"Helpful" Feed Providers</h2> <p>Imagine an analyst reverses a new malware or RAT sample and identifies that it uses a particular URL to talk back to its creator. He will of course generate an indicator in the report for that URL. However, sometimes the feed provider will go one step further and think "but what about people that want to match this in netflow, firewall or DNS logs?", and do you the favor of also generating indicators for:</p> <ol> <li> <p>The hostname of the URL, so you can match this on DNS;</p> </li> <li> <p>The IP addresses that hostname resolved to at the time of the analysis.</p> </li> </ol> <p>This creates all sort of problems and piles onto the false positives.</p> <p>First, extracting the hostname is not always appropriate. Attackers might control the entire content served under that hostname (think DGAs, a single compromised web server that attacker fully controls). However, it might also be a portal with completely independent sub-sites hosted under different paths that share no infrastructure except for a load balancer that routes requests appropriately. Or it might be something like a Google Drive or Dropbox link, or a URL shortener. So considering the entire domain to be compromised / malicious because of a few URLs within it is often a step too far.</p> <p>It's even worse when resolving domain names to IP addresses, even for domains completely dedicated to malicious purposes. Firstly, we know that miscreants can and will <a href=https://en.wikipedia.org/wiki/Fast_flux>switch the IP addresses a domain resolves to often</a>, and the IPs you receive will most likely be outdated by the time you get to use them. Second, it's not uncommon for malicious domains to be using a service like <a href=https://www.cloudflare.com/ >CloudFlare</a>, <a href=https://www.incapsula.com/ >Incapsula</a> or a shared hosting service. So if you resolve the domain, you'll get an IP address that's shared with possibly hundreds of benign websites. Or it could be temporarily parked at a benign IP address such as 8.8.8.8. Again, knowing that a domain is malicious does not necessarily mean that all of the IPs it resolves to are mostly or completely malicious as well.</p> <p>Feed providers, take note: having this extra information would be more helpful if it was possible to distinguish the <em>principled</em> indicators from the <em>derived</em> ones. But alas, this information is often not present in the computer-readable indicators.</p> <h2>Conclusion</h2> <p>I hope this article helps people realize that organizations need to put proper processes and/or automation in place to overcome the problems identified above if they decide to use threat intelligence indicators for detection. Even though threat intelligence indicators are really valuable allies to information security monitoring and DFIR initiatives, they are not signatures and should be used with appropriate care.</p> <a href=# class=go-top>Go Top</a> <div class=comments> <div id=disqus_thread></div> <script>
         /**
          * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
          * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
         */
         var disqus_config = function () {
           this.page.url = "https://asieira.github.io/threat-intelligence-indicators-are-not-signatures.html"; // Replace PAGE_URL with your page's canonical URL variable
           this.page.identifier = "Threat Intelligence Indicators are not Signatures"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
         };
         (function() { // DON'T EDIT BELOW THIS LINE
           var d = document, s = d.createElement('script');

           s.src = '//infoseczanshin.disqus.com/embed.js';

           s.setAttribute('data-timestamp', +new Date());
           (d.head || d.body).appendChild(s);
         })();
       </script> <noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> </div> </div> <footer class=footer> <p>&copy; Alexandre Sieira &ndash; Built with a modified version of <a href=https://github.com/PurePelicanTheme/pure-single>Pure Theme</a> for <a href=http://blog.getpelican.com/ >Pelican</a> </p> </footer> </div> </div> </div> <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73747222-1', 'auto');
  ga('send', 'pageview');

</script> </body> </html>